# PHP Complete Guide

![Bidur Sapkota](https://www.bidursapkota.com.np/_next/image?url=%2Fimages%2Fprofile3.png&w=48&q=75 "Bidur Sapkota - Developer")&nbsp;[Bidur Sapkota](https://www.bidursapkota.com.np/)

![PHP Complete Guide by Bidur Sapkota](/images/php/php.jpg "PHP Complete Guide â€“ Blog by Bidur Sapkota")

## Table of Contents

1. [Introduction to Server Side Scripting](#introduction-to-server-side-scripting)
2. [PHP Basics](#php-basics)
3. [Control Structures](#control-structures)
4. [Arrays and Functions](#arrays-and-functions)
5. [Form Handling](#form-handling)
6. [File Operations](#file-operations)
7. [Sessions and Cookies](#sessions-and-cookies)
8. [Object-Oriented Programming](#object-oriented-programming)
9. [Database Operations](#database-operations)
10. [AJAX](#ajax)

---

## Introduction to Server Side Scripting

Server-side scripting is a technique where **scripts are executed on the web server to generate dynamic web pages**. Unlike client-side scripting (JavaScript), server-side scripts run on the server before sending the result to the browser.

**Advantages:**

- Dynamic content generation
- Database interaction
- Secure processing (code not visible to users)
- Session management

**FUN**

```js
// chrome://dino/
Runner.prototype.gameOver = function () {};
```

**PHP (Hypertext Preprocessor)** is a popular open-source server-side scripting language designed for web development.

---

## PHP Basics

### Basic PHP Syntax

PHP code is embedded within HTML using special tags. Files use `.php` extension.

```php
<?php
    echo "Hello, World!";
?>
```

**Key Points:**

- PHP code starts with `<?php` and ends with `?>`
- Statements end with semicolon (`;`)
- PHP files can contain HTML, CSS, JavaScript, and PHP code

```php
<!DOCTYPE html>
<html>
<body>
    <h1>My PHP Page</h1>
    <?php
        echo "<p>This is generated by PHP</p>";
    ?>
</body>
</html>
```

### Comments in PHP

Comments are used to document code and are ignored during execution.

```php
<?php
    // Single-line comment

    # Another single-line comment

    /*
        Multi-line comment
        Can span multiple lines
    */

    echo "Comments help explain code"; // Inline comment
?>
```

### Variables

Variables store data values. In PHP, variables start with `$` followed by the variable name.

**Rules:**

- Start with `$` sign
- Must begin with a letter or underscore
- Can only contain alphanumeric characters and underscores
- Case-sensitive

```php
<?php
    $name = "John";           // String
    $age = 25;                // Integer
    $price = 19.99;           // Float
    $is_student = true;       // Boolean

    echo "Name: $name<br>";
    echo "Age: $age<br>";
    echo "Price: $price<br>";

    // Variable concatenation
    echo "Hello, " . $name . "!";
?>
```

### PHP Operators

#### Arithmetic Operators

```php
<?php
    $a = 10;
    $b = 3;

    echo $a + $b;  // Addition: 13
    echo $a - $b;  // Subtraction: 7
    echo $a * $b;  // Multiplication: 30
    echo $a / $b;  // Division: 3.333...
    echo $a % $b;  // Modulus: 1
    echo $a ** $b; // Exponentiation: 1000
?>
```

#### Assignment Operators

```php
<?php
    $x = 10;
    $x += 5;  // $x = $x + 5; Result: 15
    $x -= 3;  // $x = $x - 3; Result: 12
    $x *= 2;  // $x = $x * 2; Result: 24
    $x /= 4;  // $x = $x / 4; Result: 6
?>
```

#### Comparison Operators

```php
<?php
    $a = 5;
    $b = "5";

    var_dump($a == $b);   // Equal: true
    var_dump($a === $b);  // Identical: false (different types)
    var_dump($a != $b);   // Not equal: false
    var_dump($a !== $b);  // Not identical: true
    var_dump($a > 3);     // Greater than: true
    var_dump($a < 10);    // Less than: true
?>
```

#### Logical Operators

```php
<?php
    $x = true;
    $y = false;

    var_dump($x && $y);  // AND: false
    var_dump($x || $y);  // OR: true
    var_dump(!$x);       // NOT: false
?>
```

---

## Control Structures

### If-Else Statement

```php
<?php
    $age = 20;

    if ($age < 18) {
        echo "Minor";
    } elseif ($age >= 18 && $age < 60) {
        echo "Adult";
    } else {
        echo "Senior";
    }
?>
```

**Ternary Operator:**

```php
<?php
    $age = 20;
    $status = ($age >= 18) ? "Adult" : "Minor";
    echo $status;
?>
```

### Switch Statement

```php
<?php
    $day = "Monday";

    switch ($day) {
        case "Monday":
            echo "Start of work week";
            break;
        case "Friday":
            echo "End of work week";
            break;
        case "Saturday":
        case "Sunday":
            echo "Weekend!";
            break;
        default:
            echo "Midweek day";
    }
?>
```

### While Loop

```php
<?php
    $count = 1;

    while ($count <= 5) {
        echo "Count: $count<br>";
        $count++;
    }
?>
```

### Do-While Loop

```php
<?php
    $num = 1;

    do {
        echo "Number: $num<br>";
        $num++;
    } while ($num <= 5);
?>
```

### For Loop

```php
<?php
    for ($i = 1; $i <= 5; $i++) {
        echo "Iteration: $i<br>";
    }

    // Nested loop example
    for ($i = 1; $i <= 3; $i++) {
        for ($j = 1; $j <= 3; $j++) {
            echo "($i, $j) ";
        }
        echo "<br>";
    }
?>
```

---

## Arrays and Functions

### Arrays

Arrays store multiple values in a single variable.

#### Indexed Arrays

```php
<?php
    $fruits = array("Apple", "Banana", "Orange");
    // or
    $fruits = ["Apple", "Banana", "Orange"];

    echo $fruits[0];  // Apple
    echo count($fruits);  // 3

    // Adding elements
    $fruits[] = "Mango";
?>
```

#### Associative Arrays

```php
<?php
    $person = array(
        "name" => "John",
        "age" => 25,
        "city" => "New York"
    );

    echo $person["name"];  // John
    echo $person["age"];   // 25
?>
```

#### Multidimensional Arrays

```php
<?php
    $students = array(
        array("John", 25, "A"),
        array("Jane", 23, "B"),
        array("Bob", 27, "A")
    );

    echo $students[0][0];  // John
    echo $students[1][2];  // B
?>
```

### ForEach Loop

Specially designed for iterating through arrays.

```php
<?php
    $colors = ["Red", "Green", "Blue"];

    foreach ($colors as $color) {
        echo "$color<br>";
    }

    // With associative arrays
    $person = ["name" => "John", "age" => 25];

    foreach ($person as $key => $value) {
        echo "$key: $value<br>";
    }
?>
```

### Functions

Functions are reusable blocks of code.

```php
<?php
    // Simple function
    function greet() {
        echo "Hello, World!";
    }
    greet();

    // Function with parameters
    function addNumbers($a, $b) {
        return $a + $b;
    }
    $result = addNumbers(5, 3);
    echo $result;  // 8

    // Default parameter values
    function sayHello($name = "Guest") {
        return "Hello, $name!";
    }
    echo sayHello();        // Hello, Guest!
    echo sayHello("John");  // Hello, John!

    // Variable scope
    $global_var = 10;

    function testScope() {
        global $global_var;
        $local_var = 5;
        echo $global_var;  // 10
    }
?>
```

---

## Form Handling

### PHP $\_GET

Used to collect form data sent via URL parameters (visible in URL).

**HTML Form:**

```html
<form action="process.php" method="GET">
  Name: <input type="text" name="username" />
  <input type="submit" value="Submit" />
</form>
```

**process.php:**

```php
<?php
    if (isset($_GET['username'])) {
        $name = $_GET['username'];
        echo "Welcome, " . htmlspecialchars($name);
    }
?>
```

### PHP $\_POST

Used to collect form data sent via HTTP POST (not visible in URL, more secure).

**HTML Form:**

```html
<form action="process.php" method="POST">
  Email: <input type="email" name="email" /> Password:
  <input type="password" name="password" />
  <input type="submit" value="Login" />
</form>
```

**process.php:**

```php
<?php
    if ($_SERVER["REQUEST_METHOD"] == "POST") {
        $email = $_POST['email'];
        $password = $_POST['password'];

        // Sanitize input
        $email = filter_var($email, FILTER_SANITIZE_EMAIL);

        echo "Email: " . htmlspecialchars($email);
    }
?>
```

### PHP $\_REQUEST

Contains contents of both $\_GET, $\_POST, and $\_COOKIE.

```php
<?php
    if (isset($_REQUEST['username'])) {
        $username = $_REQUEST['username'];
        echo "Username: " . htmlspecialchars($username);
    }
?>
```

### PHP Date Function

```php
<?php
    // Current date and time
    echo date("Y-m-d H:i:s");  // 2024-03-15 14:30:45

    // Different formats
    echo date("d/m/Y");        // 15/03/2024
    echo date("l, F j, Y");    // Friday, March 15, 2024
    echo date("h:i A");        // 02:30 PM

    // Timestamp
    $timestamp = time();
    echo date("Y-m-d", $timestamp);

    // Custom date
    $date = mktime(12, 30, 0, 3, 15, 2024);
    echo date("Y-m-d H:i:s", $date);

    // strtotime function
    echo date("Y-m-d", strtotime("next Monday"));
    echo date("Y-m-d", strtotime("+1 week"));
?>
```

### PHP Include File

Includes and evaluates the specified file.

**header.php:**

```php
<?php
    echo "<h1>Website Header</h1>";
    echo "<nav>Navigation Menu</nav>";
?>
```

**index.php:**

```php
<?php
    include 'header.php';  // Includes file, continues on error
    // or
    require 'header.php';  // Includes file, stops on error

    echo "<p>Main content</p>";

    include_once 'header.php';  // Includes only once
    require_once 'header.php';  // Requires only once
?>
```

---

## File Operations

### File Handling

#### Reading Files

```php
<?php
    // Read entire file
    $content = file_get_contents("data.txt");
    echo $content;

    // Read file line by line
    $file = fopen("data.txt", "r");
    if ($file) {
        while (($line = fgets($file)) !== false) {
            echo $line . "<br>";
        }
        fclose($file);
    }

    // Read file into array
    $lines = file("data.txt");
    foreach ($lines as $line) {
        echo $line . "<br>";
    }
?>
```

#### Writing to Files

```php
<?php
    // Write to file (overwrites)
    $content = "Hello, World!";
    file_put_contents("output.txt", $content);

    // Append to file
    $content = "\nNew line";
    file_put_contents("output.txt", $content, FILE_APPEND);

    // Using fopen
    $file = fopen("output.txt", "w");
    fwrite($file, "Hello, World!");
    fclose($file);

    // File modes:
    // r - Read only
    // w - Write only (overwrites)
    // a - Append
    // r+ - Read and write
    // w+ - Write and read (overwrites)
    // a+ - Append and read
?>
```

#### File Operations

```php
<?php
    // Check if file exists
    if (file_exists("data.txt")) {
        echo "File exists";
    }

    // Delete file
    unlink("old_file.txt");

    // Copy file
    copy("source.txt", "destination.txt");

    // Rename/Move file
    rename("old_name.txt", "new_name.txt");

    // Get file size
    echo filesize("data.txt") . " bytes";

    // Get file modification time
    echo date("Y-m-d H:i:s", filemtime("data.txt"));
?>
```

### File Uploading

**HTML Form:**

```html
<form action="upload.php" method="POST" enctype="multipart/form-data">
  Select file: <input type="file" name="fileToUpload" />
  <input type="submit" value="Upload" name="submit" />
</form>
```

**upload.php:**

```php
<?php
    if (isset($_POST['submit'])) {
        $target_dir = "uploads/";
        $target_file = $target_dir . basename($_FILES["fileToUpload"]["name"]);
        $uploadOk = 1;
        $imageFileType = strtolower(pathinfo($target_file, PATHINFO_EXTENSION));

        // Check if file is an actual image
        if (isset($_POST["submit"])) {
            $check = getimagesize($_FILES["fileToUpload"]["tmp_name"]);
            if ($check !== false) {
                echo "File is an image - " . $check["mime"] . ".";
                $uploadOk = 1;
            } else {
                echo "File is not an image.";
                $uploadOk = 0;
            }
        }

        // Check file size (5MB limit)
        if ($_FILES["fileToUpload"]["size"] > 5000000) {
            echo "File is too large.";
            $uploadOk = 0;
        }

        // Allow certain file formats
        $allowed = array("jpg", "jpeg", "png", "gif");
        if (!in_array($imageFileType, $allowed)) {
            echo "Only JPG, JPEG, PNG & GIF files are allowed.";
            $uploadOk = 0;
        }

        // Check if $uploadOk is set to 0 by an error
        if ($uploadOk == 0) {
            echo "File was not uploaded.";
        } else {
            if (move_uploaded_file($_FILES["fileToUpload"]["tmp_name"], $target_file)) {
                echo "File uploaded successfully.";
            } else {
                echo "Error uploading file.";
            }
        }
    }
?>
```

---

## Sessions and Cookies

### PHP Sessions

Sessions store user information on the server across multiple pages.

```php
<?php
    // Start session
    session_start();

    // Set session variables
    $_SESSION['username'] = "john_doe";
    $_SESSION['user_id'] = 123;
    $_SESSION['login_time'] = time();

    echo "Session started for " . $_SESSION['username'];
?>
```

**Accessing session data (another page):**

```php
<?php
    session_start();

    if (isset($_SESSION['username'])) {
        echo "Welcome back, " . $_SESSION['username'];
    } else {
        echo "Please login first.";
    }
?>
```

**Destroying session:**

```php
<?php
    session_start();

    // Remove specific session variable
    unset($_SESSION['username']);

    // Destroy all session data
    session_destroy();
?>
```

### PHP Cookies

Cookies store data on the client's browser.

```php
<?php
    // Set cookie (name, value, expiration, path, domain, secure, httponly)
    setcookie("user", "John Doe", time() + (86400 * 30), "/"); // 30 days

    // Set multiple cookies
    setcookie("theme", "dark", time() + (86400 * 30), "/");
    setcookie("language", "en", time() + (86400 * 30), "/");
?>
```

**Accessing cookies:**

```php
<?php
    if (isset($_COOKIE['user'])) {
        echo "Welcome " . $_COOKIE['user'];
    } else {
        echo "Cookie not set.";
    }

    // Display all cookies
    foreach ($_COOKIE as $key => $value) {
        echo "$key: $value<br>";
    }
?>
```

**Deleting cookies:**

```php
<?php
    // Set expiration to past time
    setcookie("user", "", time() - 3600, "/");
?>
```

### Sending Emails

```php
<?php
    // Simple email
    $to = "recipient@example.com";
    $subject = "Test Email";
    $message = "This is a test email message.";
    $headers = "From: sender@example.com";

    if (mail($to, $subject, $message, $headers)) {
        echo "Email sent successfully";
    } else {
        echo "Email sending failed";
    }

    // HTML email
    $to = "recipient@example.com";
    $subject = "HTML Email";
    $message = "
    <html>
    <head>
        <title>HTML Email</title>
    </head>
    <body>
        <h1>Welcome!</h1>
        <p>This is an <strong>HTML</strong> email.</p>
    </body>
    </html>
    ";

    $headers = "MIME-Version: 1.0" . "\r\n";
    $headers .= "Content-type:text/html;charset=UTF-8" . "\r\n";
    $headers .= "From: sender@example.com" . "\r\n";
    $headers .= "Cc: cc@example.com" . "\r\n";

    mail($to, $subject, $message, $headers);
?>
```

---

## Object-Oriented Programming

### Classes and Objects

A class is a template for objects. An object is an instance of a class.

```php
<?php
    class Car {
        // Properties
        public $brand;
        public $color;
        public $year;

        // Method
        public function displayInfo() {
            echo "Brand: $this->brand, Color: $this->color, Year: $this->year";
        }
    }

    // Creating objects
    $car1 = new Car();
    $car1->brand = "Toyota";
    $car1->color = "Red";
    $car1->year = 2020;
    $car1->displayInfo();

    $car2 = new Car();
    $car2->brand = "Honda";
    $car2->color = "Blue";
    $car2->year = 2021;
    $car2->displayInfo();
?>
```

### Constructors and Destructors

```php
<?php
    class Person {
        public $name;
        public $age;

        // Constructor - called when object is created
        public function __construct($name, $age) {
            $this->name = $name;
            $this->age = $age;
            echo "Person object created<br>";
        }

        // Destructor - called when object is destroyed
        public function __destruct() {
            echo "Person object destroyed<br>";
        }

        public function introduce() {
            echo "Hi, I'm $this->name and I'm $this->age years old.<br>";
        }
    }

    $person = new Person("John", 25);
    $person->introduce();
    // Destructor called automatically at end of script
?>
```

### Encapsulation

Encapsulation hides internal details and controls access through access modifiers.

```php
<?php
    class BankAccount {
        private $balance;  // Private property
        protected $accountNumber;
        public $holderName;

        public function __construct($holder, $account, $initialBalance) {
            $this->holderName = $holder;
            $this->accountNumber = $account;
            $this->balance = $initialBalance;
        }

        // Getter method
        public function getBalance() {
            return $this->balance;
        }

        // Setter method with validation
        public function deposit($amount) {
            if ($amount > 0) {
                $this->balance += $amount;
                return true;
            }
            return false;
        }

        public function withdraw($amount) {
            if ($amount > 0 && $amount <= $this->balance) {
                $this->balance -= $amount;
                return true;
            }
            return false;
        }
    }

    $account = new BankAccount("John Doe", "ACC123", 1000);
    $account->deposit(500);
    echo "Balance: " . $account->getBalance();  // 1500
    $account->withdraw(200);
    echo "Balance: " . $account->getBalance();  // 1300
?>
```

### Inheritance

Inheritance allows a class to inherit properties and methods from another class.

```php
<?php
    class Animal {
        public $name;
        protected $age;

        public function __construct($name, $age) {
            $this->name = $name;
            $this->age = $age;
        }

        public function makeSound() {
            echo "Some generic sound<br>";
        }

        public function getAge() {
            return $this->age;
        }
    }

    class Dog extends Animal {
        public $breed;

        public function __construct($name, $age, $breed) {
            parent::__construct($name, $age);  // Call parent constructor
            $this->breed = $breed;
        }

        // Method overriding
        public function makeSound() {
            echo "Woof! Woof!<br>";
        }

        public function fetch() {
            echo "$this->name is fetching the ball<br>";
        }
    }

    class Cat extends Animal {
        public function makeSound() {
            echo "Meow!<br>";
        }
    }

    $dog = new Dog("Buddy", 3, "Labrador");
    $dog->makeSound();  // Woof! Woof!
    $dog->fetch();
    echo "Age: " . $dog->getAge();

    $cat = new Cat("Whiskers", 2);
    $cat->makeSound();  // Meow!
?>
```

### Polymorphism

Polymorphism allows objects of different classes to be treated as objects of a common parent class.

```php
<?php
    abstract class Shape {
        protected $name;

        public function __construct($name) {
            $this->name = $name;
        }

        // Abstract method - must be implemented by child classes
        abstract public function calculateArea();

        public function display() {
            echo "Shape: $this->name<br>";
            echo "Area: " . $this->calculateArea() . "<br>";
        }
    }

    class Circle extends Shape {
        private $radius;

        public function __construct($radius) {
            parent::__construct("Circle");
            $this->radius = $radius;
        }

        public function calculateArea() {
            return pi() * $this->radius * $this->radius;
        }
    }

    class Rectangle extends Shape {
        private $width;
        private $height;

        public function __construct($width, $height) {
            parent::__construct("Rectangle");
            $this->width = $width;
            $this->height = $height;
        }

        public function calculateArea() {
            return $this->width * $this->height;
        }
    }

    // Polymorphism in action
    $shapes = [
        new Circle(5),
        new Rectangle(4, 6),
        new Circle(3)
    ];

    foreach ($shapes as $shape) {
        $shape->display();
        echo "<br>";
    }
?>
```

### Static Members

Static properties and methods belong to the class itself, not to objects.

```php
<?php
    class Counter {
        public static $count = 0;
        public $instanceCount = 0;

        public function __construct() {
            self::$count++;  // Access static property
            $this->instanceCount++;
        }

        public static function getCount() {
            return self::$count;
        }

        public static function reset() {
            self::$count = 0;
        }
    }

    $obj1 = new Counter();
    $obj2 = new Counter();
    $obj3 = new Counter();

    echo "Total objects created: " . Counter::getCount();  // 3
    echo "Instance count: " . $obj1->instanceCount;  // 1

    Counter::reset();
    echo "After reset: " . Counter::$count;  // 0
?>
```

### Exception Handling

Exception handling manages runtime errors gracefully.

```php
<?php
    // Basic exception handling
    function divide($a, $b) {
        if ($b == 0) {
            throw new Exception("Division by zero error");
        }
        return $a / $b;
    }

    try {
        echo divide(10, 2) . "<br>";  // 5
        echo divide(10, 0) . "<br>";  // Throws exception
    } catch (Exception $e) {
        echo "Error: " . $e->getMessage() . "<br>";
    } finally {
        echo "Execution completed<br>";
    }

    // Custom exception class
    class InvalidAgeException extends Exception {
        public function errorMessage() {
            return "Error: Age must be between 18 and 100. You entered: " . $this->getMessage();
        }
    }

    function checkAge($age) {
        if ($age < 18 || $age > 100) {
            throw new InvalidAgeException($age);
        }
        return "Valid age: $age";
    }

    try {
        echo checkAge(25) . "<br>";
        echo checkAge(150) . "<br>";
    } catch (InvalidAgeException $e) {
        echo $e->errorMessage();
    } catch (Exception $e) {
        echo "General error: " . $e->getMessage();
    }

    // Multiple catch blocks
    try {
        // Some code
    } catch (InvalidAgeException $e) {
        // Handle specific exception
    } catch (Exception $e) {
        // Handle general exception
    }
?>
```

---

## Database Operations

### Introduction to MySQL

MySQL is a popular relational database management system. PHP can interact with MySQL to store and retrieve data.

**Key Concepts:**

- Database: Collection of tables
- Table: Collection of rows and columns
- Row: Single record
- Column: Field in a record

### PHP MySQL Connect to Database

```php
<?php
    // Database credentials
    $servername = "localhost";
    $username = "root";
    $password = "";
    $database = "mydb";

    // Create connection using MySQLi (procedural)
    $conn = mysqli_connect($servername, $username, $password, $database);

    // Check connection
    if (!$conn) {
        die("Connection failed: " . mysqli_connect_error());
    }
    echo "Connected successfully<br>";

    // Using MySQLi (object-oriented)
    $conn = new mysqli($servername, $username, $password, $database);

    if ($conn->connect_error) {
        die("Connection failed: " . $conn->connect_error);
    }
    echo "Connected successfully<br>";

    // Using PDO (PHP Data Objects)
    try {
        $conn = new PDO("mysql:host=$servername;dbname=$database", $username, $password);
        $conn->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
        echo "Connected successfully<br>";
    } catch(PDOException $e) {
        echo "Connection failed: " . $e->getMessage();
    }
?>
```

### Database Operations (CRUD)

```php
<?php
    $servername = "localhost";
    $username = "root";
    $password = "";
    $database = "mydb";

    $conn = new mysqli($servername, $username, $password, $database);

    // CREATE - Insert data
    $sql = "INSERT INTO users (name, email, age) VALUES ('John Doe', 'john@example.com', 25)";

    if ($conn->query($sql) === TRUE) {
        echo "New record created successfully<br>";
        echo "Last inserted ID: " . $conn->insert_id . "<br>";
    } else {
        echo "Error: " . $sql . "<br>" . $conn->error;
    }

    // Prepared statements (secure way to insert data)
    $stmt = $conn->prepare("INSERT INTO users (name, email, age) VALUES (?, ?, ?)");
    $stmt->bind_param("ssi", $name, $email, $age);

    $name = "Jane Smith";
    $email = "jane@example.com";
    $age = 28;
    $stmt->execute();

    echo "Record inserted successfully<br>";
    $stmt->close();

    // READ - Select data
    $sql = "SELECT id, name, email, age FROM users";
    $result = $conn->query($sql);

    if ($result->num_rows > 0) {
        while($row = $result->fetch_assoc()) {
            echo "ID: " . $row["id"] . " - Name: " . $row["name"] . " - Email: " . $row["email"] . "<br>";
        }
    } else {
        echo "0 results";
    }

    // UPDATE - Modify data
    $sql = "UPDATE users SET age=30 WHERE name='John Doe'";

    if ($conn->query($sql) === TRUE) {
        echo "Record updated successfully<br>";
        echo "Rows affected: " . $conn->affected_rows . "<br>";
    } else {
        echo "Error updating record: " . $conn->error;
    }

    // DELETE - Remove data
    $sql = "DELETE FROM users WHERE id=1";

    if ($conn->query($sql) === TRUE) {
        echo "Record deleted successfully<br>";
    } else {
        echo "Error deleting record: " . $conn->error;
    }

    // Using PDO for database operations
    try {
        $pdo = new PDO("mysql:host=$servername;dbname=$database", $username, $password);
        $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

        // Insert with PDO
        $stmt = $pdo->prepare("INSERT INTO users (name, email, age) VALUES (:name, :email, :age)");
        $stmt->execute(['name' => 'Bob', 'email' => 'bob@example.com', 'age' => 32]);

        // Select with PDO
        $stmt = $pdo->query("SELECT * FROM users");
        $users = $stmt->fetchAll(PDO::FETCH_ASSOC);

        foreach ($users as $user) {
            echo $user['name'] . " - " . $user['email'] . "<br>";
        }
    } catch(PDOException $e) {
        echo "Error: " . $e->getMessage();
    }
?>
```

### Closing a Connection

```php
<?php
    // MySQLi (procedural)
    mysqli_close($conn);

    // MySQLi (object-oriented)
    $conn->close();

    // PDO
    $conn = null;

    echo "Connection closed successfully";
?>
```

**Complete Database Example:**

```php
<?php
    class Database {
        private $host = "localhost";
        private $username = "root";
        private $password = "";
        private $database = "mydb";
        private $conn;

        public function __construct() {
            $this->connect();
        }

        private function connect() {
            try {
                $this->conn = new PDO(
                    "mysql:host=$this->host;dbname=$this->database",
                    $this->username,
                    $this->password
                );
                $this->conn->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
            } catch(PDOException $e) {
                die("Connection failed: " . $e->getMessage());
            }
        }

        public function getUsers() {
            $stmt = $this->conn->query("SELECT * FROM users");
            return $stmt->fetchAll(PDO::FETCH_ASSOC);
        }

        public function addUser($name, $email, $age) {
            $stmt = $this->conn->prepare("INSERT INTO users (name, email, age) VALUES (?, ?, ?)");
            return $stmt->execute([$name, $email, $age]);
        }

        public function __destruct() {
            $this->conn = null;
        }
    }

    // Usage
    $db = new Database();
    $db->addUser("Alice", "alice@example.com", 27);
    $users = $db->getUsers();

    foreach ($users as $user) {
        echo $user['name'] . "<br>";
    }
?>
```

---

## AJAX

### AJAX (Asynchronous JavaScript and XML)

AJAX allows web pages to update asynchronously by exchanging data with the server behind the scenes without reloading the entire page.

**Benefits:**

- Faster page updates
- Better user experience
- Reduced server load
- Dynamic content loading

### Using PHP with AJAX

**Example 1: Simple AJAX Request**

**index.html:**

```html
<!DOCTYPE html>
<html>
  <head>
    <title>AJAX Example</title>
    <script>
      function loadContent() {
        var xhr = new XMLHttpRequest();

        xhr.onreadystatechange = function () {
          if (this.readyState == 4 && this.status == 200) {
            document.getElementById("content").innerHTML = this.responseText;
          }
        };

        xhr.open("GET", "ajax_handler.php", true);
        xhr.send();
      }
    </script>
  </head>
  <body>
    <h1>AJAX Demo</h1>
    <button onclick="loadContent()">Load Content</button>
    <div id="content"></div>
  </body>
</html>
```

**ajax_handler.php:**

```php
<?php
    echo "<h2>Content loaded via AJAX</h2>";
    echo "<p>Current time: " . date("h:i:s A") . "</p>";
?>
```

**Example 2: AJAX with POST Data**

**index.html:**

```html
<!DOCTYPE html>
<html>
  <head>
    <title>AJAX POST Example</title>
    <script>
      function sendData() {
        var name = document.getElementById("name").value;
        var email = document.getElementById("email").value;

        var xhr = new XMLHttpRequest();

        xhr.onreadystatechange = function () {
          if (this.readyState == 4 && this.status == 200) {
            document.getElementById("response").innerHTML = this.responseText;
          }
        };

        xhr.open("POST", "process_ajax.php", true);
        xhr.setRequestHeader(
          "Content-type",
          "application/x-www-form-urlencoded"
        );
        xhr.send("name=" + name + "&email=" + email);
      }
    </script>
  </head>
  <body>
    <h1>AJAX POST Demo</h1>
    <input type="text" id="name" placeholder="Name" />
    <input type="email" id="email" placeholder="Email" />
    <button onclick="sendData()">Submit</button>
    <div id="response"></div>
  </body>
</html>
```

**process_ajax.php:**

```php
<?php
    if ($_SERVER["REQUEST_METHOD"] == "POST") {
        $name = htmlspecialchars($_POST['name']);
        $email = htmlspecialchars($_POST['email']);

        if (empty($name) || empty($email)) {
            echo "Please fill all fields";
        } else {
            echo "Thank you, $name! Your email ($email) has been received.";
        }
    }
?>
```

### Using PHP + MySQL with AJAX

**Example: Live Search with AJAX**

**search.html:**

```html
<!DOCTYPE html>
<html>
  <head>
    <title>Live Search</title>
    <script>
      function searchUsers(str) {
        if (str.length == 0) {
          document.getElementById("results").innerHTML = "";
          return;
        }

        var xhr = new XMLHttpRequest();

        xhr.onreadystatechange = function () {
          if (this.readyState == 4 && this.status == 200) {
            document.getElementById("results").innerHTML = this.responseText;
          }
        };

        xhr.open("GET", "search_users.php?q=" + str, true);
        xhr.send();
      }
    </script>
    <style>
      #results {
        border: 1px solid #ddd;
        margin-top: 10px;
        padding: 10px;
      }
      .user-item {
        padding: 5px;
        border-bottom: 1px solid #eee;
      }
    </style>
  </head>
  <body>
    <h1>User Search</h1>
    <input
      type="text"
      onkeyup="searchUsers(this.value)"
      placeholder="Search users..."
    />
    <div id="results"></div>
  </body>
</html>
```

**search_users.php:**

```php
<?php
    $servername = "localhost";
    $username = "root";
    $password = "";
    $database = "mydb";

    $conn = new mysqli($servername, $username, $password, $database);

    if ($conn->connect_error) {
        die("Connection failed");
    }

    $search = $conn->real_escape_string($_GET['q']);

    $sql = "SELECT name, email FROM users WHERE name LIKE '%$search%' OR email LIKE '%$search%' LIMIT 10";
    $result = $conn->query($sql);

    if ($result->num_rows > 0) {
        while($row = $result->fetch_assoc()) {
            echo "<div class='user-item'>";
            echo "<strong>" . htmlspecialchars($row['name']) . "</strong><br>";
            echo htmlspecialchars($row['email']);
            echo "</div>";
        }
    } else {
        echo "No results found";
    }

    $conn->close();
?>
```

**Example: Dynamic Data Loading with JSON**

**get_users.php:**

```php
<?php
    header('Content-Type: application/json');

    $servername = "localhost";
    $username = "root";
    $password = "";
    $database = "mydb";

    $conn = new mysqli($servername, $username, $password, $database);

    if ($conn->connect_error) {
        echo json_encode(['error' => 'Connection failed']);
        exit();
    }

    $sql = "SELECT id, name, email, age FROM users";
    $result = $conn->query($sql);

    $users = array();

    if ($result->num_rows > 0) {
        while($row = $result->fetch_assoc()) {
            $users[] = $row;
        }
    }

    echo json_encode($users);

    $conn->close();
?>
```

**users.html:**

```html
<!DOCTYPE html>
<html>
  <head>
    <title>User List</title>
    <script>
      function loadUsers() {
        var xhr = new XMLHttpRequest();

        xhr.onreadystatechange = function () {
          if (this.readyState == 4 && this.status == 200) {
            var users = JSON.parse(this.responseText);
            displayUsers(users);
          }
        };

        xhr.open("GET", "get_users.php", true);
        xhr.send();
      }

      function displayUsers(users) {
        var html =
          "<table border='1'><tr><th>ID</th><th>Name</th><th>Email</th><th>Age</th></tr>";

        users.forEach(function (user) {
          html += "<tr>";
          html += "<td>" + user.id + "</td>";
          html += "<td>" + user.name + "</td>";
          html += "<td>" + user.email + "</td>";
          html += "<td>" + user.age + "</td>";
          html += "</tr>";
        });

        html += "</table>";
        document.getElementById("userTable").innerHTML = html;
      }

      window.onload = loadUsers;
    </script>
  </head>
  <body>
    <h1>User Directory</h1>
    <button onclick="loadUsers()">Refresh</button>
    <div id="userTable"></div>
  </body>
</html>
```

**Example: AJAX Form Submission with Validation**

**register.html:**

```html
<!DOCTYPE html>
<html>
  <head>
    <title>User Registration</title>
    <script>
      function registerUser(event) {
        event.preventDefault();

        var formData = new FormData(document.getElementById("registerForm"));
        var xhr = new XMLHttpRequest();

        xhr.onreadystatechange = function () {
          if (this.readyState == 4 && this.status == 200) {
            var response = JSON.parse(this.responseText);

            if (response.success) {
              document.getElementById("message").innerHTML =
                "<p style='color: green;'>" + response.message + "</p>";
              document.getElementById("registerForm").reset();
            } else {
              document.getElementById("message").innerHTML =
                "<p style='color: red;'>" + response.message + "</p>";
            }
          }
        };

        xhr.open("POST", "register_user.php", true);
        xhr.send(formData);
      }
    </script>
  </head>
  <body>
    <h1>User Registration</h1>
    <form id="registerForm" onsubmit="registerUser(event)">
      <input type="text" name="name" placeholder="Name" required /><br />
      <input type="email" name="email" placeholder="Email" required /><br />
      <input type="number" name="age" placeholder="Age" required /><br />
      <button type="submit">Register</button>
    </form>
    <div id="message"></div>
  </body>
</html>
```

**register_user.php:**

```php
<?php
    header('Content-Type: application/json');

    if ($_SERVER["REQUEST_METHOD"] == "POST") {
        $name = trim($_POST['name']);
        $email = trim($_POST['email']);
        $age = intval($_POST['age']);

        // Validation
        if (empty($name) || empty($email) || $age <= 0) {
            echo json_encode([
                'success' => false,
                'message' => 'Please fill all fields correctly'
            ]);
            exit();
        }

        if (!filter_var($email, FILTER_VALIDATE_EMAIL)) {
            echo json_encode([
                'success' => false,
                'message' => 'Invalid email format'
            ]);
            exit();
        }

        // Database connection
        $servername = "localhost";
        $username = "root";
        $password = "";
        $database = "mydb";

        $conn = new mysqli($servername, $username, $password, $database);

        if ($conn->connect_error) {
            echo json_encode([
                'success' => false,
                'message' => 'Database connection failed'
            ]);
            exit();
        }

        // Check if email already exists
        $stmt = $conn->prepare("SELECT id FROM users WHERE email = ?");
        $stmt->bind_param("s", $email);
        $stmt->execute();
        $result = $stmt->get_result();

        if ($result->num_rows > 0) {
            echo json_encode([
                'success' => false,
                'message' => 'Email already registered'
            ]);
            $stmt->close();
            $conn->close();
            exit();
        }

        // Insert new user
        $stmt = $conn->prepare("INSERT INTO users (name, email, age) VALUES (?, ?, ?)");
        $stmt->bind_param("ssi", $name, $email, $age);

        if ($stmt->execute()) {
            echo json_encode([
                'success' => true,
                'message' => 'Registration successful!'
            ]);
        } else {
            echo json_encode([
                'success' => false,
                'message' => 'Registration failed. Please try again.'
            ]);
        }

        $stmt->close();
        $conn->close();
    }
?>
```

---

## Additional Best Practices

### Security Best Practices

1. **Always sanitize user input:**

```php
<?php
    $user_input = htmlspecialchars($_POST['input']);
    $email = filter_var($_POST['email'], FILTER_SANITIZE_EMAIL);
?>
```

2. **Use prepared statements for database queries:**

```php
<?php
    $stmt = $conn->prepare("SELECT * FROM users WHERE email = ?");
    $stmt->bind_param("s", $email);
    $stmt->execute();
?>
```

3. **Validate and verify file uploads:**

```php
<?php
    $allowed = ['jpg', 'jpeg', 'png', 'gif'];
    $extension = strtolower(pathinfo($_FILES['file']['name'], PATHINFO_EXTENSION));

    if (!in_array($extension, $allowed)) {
        die("Invalid file type");
    }
?>
```

4. **Use HTTPS for sensitive data**

5. **Implement password hashing:**

```php
<?php
    // Hash password
    $password = "user_password";
    $hashed = password_hash($password, PASSWORD_DEFAULT);

    // Verify password
    if (password_verify($password, $hashed)) {
        echo "Password is correct";
    }
?>
```

### Error Handling

```php
<?php
    // Display errors in development
    ini_set('display_errors', 1);
    error_reporting(E_ALL);

    // Log errors in production
    ini_set('display_errors', 0);
    ini_set('log_errors', 1);
    ini_set('error_log', '/path/to/error.log');

    // Custom error handler
    function customError($errno, $errstr) {
        echo "<b>Error:</b> [$errno] $errstr";
    }

    set_error_handler("customError");
?>
```
